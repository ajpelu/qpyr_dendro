---
title: "Dendro review"
author: "AJ Perez-Luque (@ajpelu)"
output: 
  md_document:
    variant: markdown_github
bibliography: ../references.bib 
csl: ../ecology.csl
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, warning=FALSE, error=TRUE, message=FALSE)
```


```{r packages, warning=FALSE, message=FALSE, echo=FALSE}
library("here")
library("tidyverse")
library("maps")
library("mapdata")
library("ggmap")
library("ggrepel")
library("cowplot")
library("ggExtra")
```

Dendro review 

```{r}
df <- read.csv(file=here::here("data_raw/dendro_review/dendro_qp_review.csv"), header=TRUE)



spain <- map_data('world', region=c("spain", "portugal"))

s <- ggplot() + 
  geom_polygon(data = spain, aes(x=long, y = lat, group = group),
                            fill=NA, colour="gray") + 
  coord_fixed(1.3) +
  geom_point(data = df, aes(x=long, y=lat, size=length), 
            shape = 21, colour = "black", fill="white") +
             #, size=length), alpha=0.3) + 
  # geom_text_repel(data = subset(df, ), aes(x=long, y=lat, label=refs)) + 
  # geom_label(data = df, aes(x=long, y=lat, size=length, label=length)) +
  scale_size(range=c(1,6), breaks=c(0,50,100,200,300,350),
             guide = guide_legend(title="Age (years)")) + 
  xlab('') + ylab('') + theme_void() + 
  theme(legend.position = "top")
  
  
  # theme(panel.grid = element_blank(),
  #       axis.line=element_blank())


elev_age <- ggplot(df, aes(x=elev, y=length)) + 
  # geom_smooth(data = subset(df, elev > 500), se=FALSE, method = 'lm', colour="gray") +
  geom_point(size = 3, colour = "black") + theme_bw() + theme(panel.grid = element_blank()) + 
  geom_text_repel(data = subset(df, refs %in% c("1","2","3","4","5","6","7","8")), size = 3, aes(label=refs)) +
  geom_label_repel(data = subset(df, refs %in% c("SJ","CA-High", "CA-Low")), 
                   size = 5, aes(label=refs),
                   box.padding = 0.25, point.padding = 0.3) +
  xlab('Elevation (m)') + ylab('Age (years)') +
  ylim(0,350) 





elev_age + annotation_custom(ggplotGrob(s), xmin = 0, xmax = 1400, ymin = 160)
# elev_age <- ggMarginal(elev_age, margins="y")
```

```{r}
ggplot(df, aes(length)) + geom_density()
```

