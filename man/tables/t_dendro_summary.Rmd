---
output:
  word_document:
    reference_docx: ../../templates/template_tables_portrait.docx
bibliography: ../../refs/references.bib
csl: ../../refs/ecology.csl
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning = FALSE)
```

```{r}
library(tidyverse)
library(here)
library(pander)
library(kableExtra)
library(knitr)
library(dplyr)
library(flextable)
```


**Table 2.** Characteristics of the mean tree ring chronologies. Values of the length year in parenthesis indicate years replicated with more than five series. RW = mean annual ring width (standard deviation in parenthesis). MS = mean sensitivity. AR(1) = mean autocorrelation of raw series. Rbt = mean correlation between series. EPS = mean expressed population signal. EPS and Rbt are calculated for the mean residual chronologies of growth indices. 

```{r}
dendro_summ <- read.csv(here::here("/data/dendro_summary", "site3_dendro_summary.csv"), header = TRUE)
cofecha <- read_delim(here::here("/data_raw/dendro_ring/cofechas.csv"), delim = ";") 


rbt <- cofecha %>% 
  group_by(name = site) %>% 
  summarise(rbt = mean(corr_w_master)) 
  

t1raw <- dendro_summ %>% mutate(name = case_when(
  site == 'caH' ~ 'CA-High', 
  site == 'caL' ~ 'CA-Low',
  site == 'sj' ~ 'SJ')) 

t2 <- t1raw %>% 
  inner_join(rbt, by="name") %>% 
  mutate(pare = ")") %>% 
  mutate_at(c(8:13), round, 3) %>% 
  unite(length_year, c(length_year,length_year5), sep=" (") %>%
  mutate_at(.vars = c("rw_mean","rw_std"), funs(formatC(., digits = 3, format = 'f'))) %>% 
  unite(RW, c(rw_mean,rw_std), sep=" (") %>%
  mutate(
    length_year = paste0(length_year, pare),
    RW = paste0(RW, pare)) %>% 
  dplyr::select(name, first_year, last_year, 
  length_year, n_trees, n_radii,
  RW, ms2, ar1, rbt, -rbar.wt, eps, -pare, -site)


ta2 <- regulartable(t2, col_keys =c("name", "first_year", "last_year", "length_year", "n_trees", "n_radii", "RW", "ms2",
                                   "ar1","rbt","eps"))
ta2 <- ta2 %>% set_header_labels(name = "Site", first_year = "First year", last_year = "Last year",
                                 length_year = "Length (years)", n_trees ="# trees", n_radii = '# cores',
                                 RW ="RW (mm)", ms2="MS", ar1="AR(1)", rbt = "Rbt", eps = "EPS") %>%
  align(align = "center", part = "header") %>% 
  bold(part = 'header') %>% 
  fontsize(part = "header", size = 10) %>% 
  fontsize(part = "body", size = 9) %>% 
  autofit(add_w = 0, add_h = 0) %>% 
  align(align = "center") 

ta2

```



