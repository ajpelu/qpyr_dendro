---
output:
  word_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 7.5
    highlight: null
    reference_docx: ../../templates/template_tables_portrait.docx
bibliography: ../../refs/references.bib
csl: ../../refs/ecology.csl
---


```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(here)
library(pander)
library(kableExtra)
library(knitr)
library(dplyr)
```


**Table 1.** Characteristics of sampled plot. Lat = latitude; Long = longitude. Dbh and height of all trees, Basal Area (BA), Density and SRD (Size ratio proportional to distance) are computed for all trees within a 10-m radius of focal trees (see methods). Temp.: annual average of minimun and maximum temperatures. Values shown here correspond to site averages. Standard deviations are shown in parentheses. Different letters indicate statistically significant differences between sites (Kruskal-Wallis test followed by Dunnâ€™s test, p<0.05). 



```{r, echo=FALSE}
topo <- read.csv(here::here("/data/sites_summary", "site_general.csv"), header = TRUE)
ages <- read.csv(here::here("/data/dendro_summary", "site3_avg_ages.csv"), header = TRUE)
dendro_summ <- read.csv(here::here("/data/dendro_summary", "site3_dendro_summary.csv"), header = TRUE)
biotic <- read.csv(here::here("/data/competence", "biotic_stand_features.csv"), header = TRUE)
letritas <- read.csv(here::here("/out/kw_stand_features", "kw_letras.csv"), header = TRUE)

letritas <- letritas %>% 
  mutate(letter = as.character(letter)) %>% 
  mutate(mivar = paste0(mivariable, '_l')) %>%
  dplyr::select(-mivariable) %>% 
  spread(key=mivar, letter)


t1raw <- topo %>% inner_join(ages, by='site') %>% 
  inner_join(dendro_summ, by='site') %>% 
  inner_join(biotic, by='site') %>% 
  inner_join(letritas, by='site')


t1raw <- t1raw %>% mutate(name = case_when(
  site == 'caH' ~ 'CA-High', 
  site == 'caL' ~ 'CA-Low',
  site == 'sj' ~ 'SJ')) 

# ADD data climate
# clima obsnev (from repo clima SN; son datos de mapas pasados 100 x 100 1960 - 2010)

clima <- read.csv(here::here("/data/climate_obsnev", "obsnev_qp_pop.csv"), header = TRUE)
cli <- clima %>% filter(pop %in% c(2,6)) %>% mutate_if(is.numeric, funs(round(., 1))) %>% 
  dplyr::select(pop, mean, variable) %>% 
  spread(variable, mean) %>% 
  mutate(name = case_when(
    pop == 2 ~ 'SJ',
    pop == 6 ~ 'CA-High'
  )) %>% dplyr::select(-pop) 

# duplicate row for CA site
x <- cli[2,] 
x$name <- 'CA-Low'
cli <- cli %>% bind_rows(x) %>% 
  mutate_at(1, round, 0) %>% 
  unite(temp, c(tmin, tmax), sep=" - ") 

t1raw <- t1raw %>% inner_join(cli, by='name') 


t1 <- t1raw %>% dplyr::select(
  name, lat_m, long_m, elev_min, elev_max, slope_mean, slope_sd, prec, temp, 
  n_trees, n_radii, dn_mean, dn_sd, h_mean, h_sd, age_mean, age_std, 
  dn_mean_all, dn_sd_all, h_mean_all, h_sd_all,
  ba_mean, ba_sd, stand_density_mean, stand_density_sd, srd_mean, srd_sd,
  all_dn_l, all_h_l, ba_l, ft_dn_l, ft_h_l, std_l, srd_l
  ) %>% 
  mutate(pare = ")") %>% 
  mutate_at(c("lat_m","long_m","slope_mean","slope_sd","ba_mean","ba_sd","srd_mean","srd_sd"), 
            funs(formatC(., digits = 2,format='f'))) %>%  
  # mutate_at(c(10:19, 22:23), round, 1) %>% 
  mutate_at(c("dn_mean","dn_sd","h_mean","h_sd","age_mean","age_std","dn_mean_all","dn_sd_all","h_mean_all","h_sd_all","stand_density_mean","stand_density_sd"),
            funs(formatC(., digits = 1,format='f'))) %>%
  mutate_at(c("elev_min", "elev_max"), funs(round(., 0))) %>% 
  unite(elev, c(elev_min, elev_max), sep= " - ") %>% 
  unite(slope, c(slope_mean, slope_sd), sep=" (") %>% 
  unite(n_trees, c(n_trees, n_radii), sep=" (") %>% 
  unite(dn, c(dn_mean, dn_sd), sep=" (") %>% 
  unite(h, c(h_mean, h_sd), sep=" (") %>% 
  unite(age, c(age_mean, age_std), sep=" (") %>% 
  unite(dn_all, c(dn_mean_all, dn_sd_all), sep=" (") %>% 
  unite(h_all, c(h_mean_all, h_sd_all), sep=" (") %>% 
  unite(ba, c(ba_mean, ba_sd), sep=" (") %>% 
  unite(stand_density, c(stand_density_mean, stand_density_sd), sep=" (") %>% 
  unite(srd, c(srd_mean, srd_sd), sep=" (") %>% 
  mutate(
    slope = paste0(slope, pare),
    n_trees = paste0(n_trees, pare),
    dn = paste(paste0(dn, pare), ft_dn_l, sep=" "),
    h = paste(paste0(h, pare), ft_h_l, sep = ' '),
    age = paste0(age, pare),
    dn_all = paste(paste0(dn_all, pare), all_dn_l, sep = ' '),
    h_all = paste(paste0(h_all, pare), all_h_l, sep = ' '),
    ba = paste(paste0(ba, pare), ba_l, sep = ' '),
    stand_density = paste(paste0(stand_density, pare), std_l, sep = ' '),
    srd = paste(paste0(srd, pare), srd_l, sep = ' ')) %>%
  dplyr::select(-pare, -all_dn_l, -all_h_l, -ba_l, -ft_dn_l, -ft_h_l, -std_l, -srd_l)
  

colnames (t1) <- c("Site", "Lat (&deg;)", "Long (&deg;)", "Elevation (m)", "Slope (&deg;)", 
                   "Prec. (mm)", "Temp. (&deg; C)",
                   "# trees (# cores)", "Dbh (cm)", "Height (m)", "Age (years)", 
                   "Dbh all (cm)", "Height all (m)", "BA (m2/ha)", "Density (trees/ha)", "SRD")

pander(t1, split.table = Inf)

```

