---
output: 
  word_document
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning = FALSE)
```

```{r load_pkg}
library("tidyverse")
library("here")
library("scales")

library("grid")
library("gridExtra")
library("patchwork")
library("ggcorrplot")
library("stringr")
library("pander")
library("lemon")
```


**Figure S4.** Percentage of *Q. pyrenaica* trees affected by GC > 50 % by site. *Black* line shows number of trees (rigth-axis). Data for number of trees > 2 is shown. 

```{r data}
gc_treesMed <- read.csv(here("data/disturbance", "disturbance_trees_gc_treshold_median.csv"), header = TRUE, sep = ',')
gc_treesMed50 <- read.csv(here("data/disturbance", "disturbance_trees_gc_treshold_median50.csv"), header = TRUE, sep = ',')
```

```{r plotGC}

colorpositivo <- c("#104E8B")
colornegativo <- c("#CD3333")

# Get min and max year and round to nearest decade
getBreaks <- function(df, v, by){ 
  x <- seq(round(min(df[v]) / 10)*10, 
           round(max(df[v]) / 10)*10, by= by) 
  x
  }

xrange <- getBreaks(gc_treesMed50, 'year', by=10)
  
label_site <- c("0_sj" = "SJ",
                "1_caH" = "CA-High",
                "2_caL" = "CA-Low")

pgc_median50 <- gc_treesMed50 %>% 
  filter(total_tree > 2) %>% 
  ggplot() +
  geom_bar(aes(x=year, y=per_pos), fill=colorpositivo, colour=colorpositivo, 
           stat = "identity", position = "dodge") + 
  geom_bar(aes(x=year, y=(-1)*per_neg), fill=colornegativo, colour=colornegativo, 
           stat = "identity", position = "dodge") +
  geom_line(aes(x=year, y=total_tree*2), colour = 'black', size = 0.2) + 
  theme_bw() + ylab('% of trees') + xlab("Year") + 
  geom_hline(yintercept=0, alpha=.4) +
  geom_hline(yintercept=c(50, -50), linetype=2, alpha=.4) +
  scale_x_continuous(breaks = xrange) +
  scale_y_continuous(limits = c(-100, 100), breaks = seq(-100, 100, by = 50),
                     sec.axis = sec_axis(~., name = '# trees', breaks = c(0,15,30))) +
  facet_rep_wrap(~site_sorted, nrow = 3, 
                 repeat.tick.labels = TRUE, labeller = as_labeller(label_site)) +
  theme(panel.grid = element_blank(), 
        strip.background = element_blank(), 
        strip.text = element_blank(),
        axis.text.y.left = element_text(size=6),
        axis.text.y.right  = element_text(size=5),
        axis.text.x = element_text(size=6),
        axis.title = element_text(size = 9)) 

```


```{r plot_out, fig.height=4.5, dpi = 300, out.width = 0.8} 
pgc_median50
```



