---
output: 
  word_document
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning = FALSE)
```

```{r load_pkg}
library("tidyverse")
library("here")
library("ggrepel")
library("scales")

library("grid")
library("gridExtra")
library("patchwork")
library("ggcorrplot")
library("stringr")
library("pander")
library("lemon")
library("viridis")
library("ggthemes")
source(here::here('/script/R/custom_functions.R'))
```

**Figure S6.** Correlation among site chronologies (CA-High, CA-Low and SJ) in different time-domains after pre-filtering the time-series with increasing size of the moving-average window (1 to 40 years). Each site chronology was smoothed using centred moving averages with different window sizes (1 to 40 years), and then Pearson's correlation coefficient between the each pair chronologies were calculated. Significance was tested using 1000 boostrap replicates and with 95 % confidence intervals built using the R packgae `boot`. 

```{r data}
correla  <- read.csv(file=here("/data/correla_ventanas_temporales/", "correla_chronos.csv"), header = TRUE)

correla <- correla %>% 
  mutate(
    name_comparison = as.factor(case_when(
      name_comparison == "caH-caL" ~ "CAHigh - CALow",
      name_comparison == "sj-caL" ~ "SJ - CALow",
      name_comparison == "sj-caH" ~ "SJ - CAHigh")))
```

```{r plot}
correla_sitesSJCALH  <- correla %>% 
  filter(metodo_correla == 'pearson') %>%
  ggplot(aes(x=size, y=estimate)) + 
  geom_line(aes(colour=name_comparison), size = 1) + 
  theme_bw() + ylab('Correlation coefficient') +
  xlab('Smoothing (centred moving average window size)') + 
  geom_hline(yintercept = 0, colour='gray', linetype=2) + 
  geom_ribbon(aes(ymax=ci_upper, ymin=ci_lower, fill=name_comparison), alpha=0.3) + 
  scale_fill_colorblind() + 
  scale_color_colorblind() +
  theme(legend.position = c(.8,.87), 
        legend.title = element_blank(), 
        legend.text = element_text(size = 6),
        panel.grid = element_blank(), 
        axis.title = element_text(size = 10), 
        axis.text = element_text(size = 7),
        legend.background = element_blank())
```

```{r plot_out, fig.width=6, dpi = 300, out.width = 0.8} 
correla_sitesSJCALH
```


```{r}
# SAVE as eps 
saveImage(correla_sitesSJCALH , path="./man/figures/svg/", dpi=300, w=20, h=14, fig= "fig_s6", u = "cm") 
```
